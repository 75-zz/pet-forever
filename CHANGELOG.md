# Changelog

このプロジェクトのすべての重要な変更を記録します。

## [0.2.7] - 2025-11-29

### 追加
- **画像フレーム機能**: 画像に額縁風のフレームを表示
  - 白い額縁（12px幅）とシャドウ効果
  - ランダムな回転（-15°〜15°）で自然な配置
  - 設定画面でフレームのON/OFF切り替えが可能
  - デフォルトでフレーム表示ON

### 修正
- **フレーム内の余白問題を解決**: 複数回の試行錯誤を経て完全に修正
  - `border`を`box-shadow`に変更（borderが内側に食い込む問題を解消）
  - 不要な`flex items-center justify-center`レイヤーを削除（縮小による余白を解消）
  - `object-contain`を`object-cover`に変更（画像がフレームいっぱいに表示）
  - `padding`を削除（内部余白を完全に排除）
  - 画像のアスペクト比に合わせたフレームサイズ計算により、トリミングなしで表示

### 技術的な改善
- `MediaPlayer.tsx`:
  - `ImageItem`コンポーネントにフレーム表示ロジックを追加
  - `handleImageLoad`で画像のアスペクト比を取得
  - `getPositionStyle`でアスペクト比に基づくフレームサイズを計算
  - `box-shadow`を使用した12px白枠を実装
  - レイヤー構造を最適化し、不要なflexコンテナを削除
- `Settings.tsx`:
  - フレームON/OFFトグルスイッチを追加
  - メディア設定セクションに「画像フレーム」設定を追加
- `types/index.ts`:
  - `MediaSettings`に`frameEnabled: boolean`を追加
  - デフォルト値を`true`に設定
- `useAppStore.ts`:
  - 設定のディープマージに`frameEnabled`を追加

### コミット履歴
- `1eb2251`: padding削除による余白解消の試み
- `7c64b68`: border→box-shadowへの変更でフレーム内部余白を解消
- `85a7624`: 内側のflexレイヤー削除
- `6f48a55`: 外側のflexレイヤー削除
- `654cc03`: object-contain→object-coverへの変更で完全解決

---

## [0.2.6] - 2025-11-20

### 修正
- **カレンダー位置管理の改善**: モード別に位置を個別保存
  - 1日表示と1か月表示で別々の位置を記憶
  - モード切り替え時に元の位置に戻るように修正
  - 1日→1か月→1日と切り替えても元の位置が保持される
  - 画面外にはみ出している場合のみ位置を調整（はみ出していない場合は位置を保持）

- **プラン選択画面のz-index修正**: 最前面に表示されるように
  - z-50 → z-[350]に変更
  - カレンダーや設定画面の上に表示されるように修正
  - backdrop-blur-smを追加して統一感を向上

### 技術的な改善
- `types/index.ts`:
  - `customPosition` → `customPositionDay` / `customPositionMonth`に分割
  - 各モードの位置を個別に保存
- `Calendar.tsx`:
  - `useDraggable`フックに`mode`パラメータを追加
  - モードに応じた位置の読み書き
  - 境界チェックを追加（right, bottom, left, top）
  - はみ出している場合のみupdateSettingsを呼び出し
- `useAppStore.ts`:
  - 設定のディープマージに`customPositionDay`と`customPositionMonth`を追加
- `Plan.tsx`:
  - z-indexを最前面（z-[350]）に変更

---

## [0.2.5] - 2025-11-20

### 追加
- **カレンダーのドラッグ機能**: カレンダーをドラッグして好きな位置に移動可能に
  - PC: マウスドラッグで即座に移動
  - スマホ/タブレット: 長押し（500ms）でドラッグ開始
  - 画面外に出ないように自動的に境界チェック
  - ドラッグ中は透明度70%で視覚フィードバック
  - カスタム位置をIndexedDBに自動保存
  - 設定画面から「位置リセット」ボタンで元の位置に戻せる
  - デフォルトでドラッグモードON

### 変更
- **ハンバーガーメニューのUI改善**: 右からスライドインする方式に変更
  - グラスモーフィズム背景（`backdrop-blur-xl`）で美しい半透明効果
  - スムーズなスライドアニメーション（300ms ease-out）
  - オーバーレイクリックでメニューを閉じる
  - メニュー項目に説明文を追加（視認性向上）
  - メニューサイズを拡大（w-72 sm:w-80）

- **設定画面の機能強化**:
  - ドラッグモード切り替えトグルスイッチを追加
  - PC/スマホそれぞれの操作方法を説明
  - カスタム位置使用時のみ「位置リセット」ボタンを表示

### 技術的な改善
- `Calendar.tsx`:
  - `useDraggable`カスタムフックを実装
  - マウスとタッチの両方に対応したドラッグ処理
  - カスタム位置使用時は固定位置クラスを無効化
  - カーソル表示を動的に変更（`cursor-move` / `cursor-pointer`）
- `Player.tsx`:
  - スライドメニューの実装
  - オーバーレイのフェードイン/アウトアニメーション
  - メニュー外クリック検知を削除（オーバーレイクリックで対応）
- `Settings.tsx`:
  - ドラッグモード設定UIを追加
  - 位置リセット機能の実装
- `types/index.ts`:
  - `CalendarSettings`に`useCustomPosition`、`customPosition`、`isDraggable`を追加
  - デフォルトで`isDraggable: true`に設定
- `useAppStore.ts`:
  - 設定のディープマージに新しいプロパティを追加

---

## [0.2.4] - 2025-11-07

### 追加
- **カレンダー文字色のカスタマイズ**: 設定画面でカレンダーの文字色を自由に変更可能に
  - カラーピッカーで任意の色を選択
  - デフォルトは黒色 (#000000)
- **カレンダー文字サイズの選択**: 小・中・大の3段階から選択可能に
  - 小: コンパクトな表示
  - 中: 標準サイズ（デフォルト）
  - 大: 大きく見やすい表示

### 変更
- **UIの改善**:
  - ハンバーガーメニューのテキスト色を黒に変更（視認性向上）
  - 再生/停止ボタンのサイズを縮小（`px-4 py-2`、`text-sm`）
  - より控えめで邪魔にならないデザインに
- **背景色**: 白背景に統一（以前のデフォルトに戻す）
  - 背景色変更機能を削除し、シンプルに

### 技術的な改善
- **設定のディープマージ機能**: IndexedDBから読み込んだ設定とデフォルト設定を適切にマージ
  - 新しいプロパティが追加された際、既存の保存データに不足しているプロパティをデフォルト値で補完
  - `textColor`と`size`プロパティの追加に対応
- `useAppStore.ts`: `mergeSettings`関数を追加し、設定の互換性を保証
- `Settings.tsx`: カレンダー文字色ピッカーと文字サイズ選択UIを追加
- `Calendar.tsx`: 動的なサイズと色の適用を実装
- `types/index.ts`: `CalendarSettings`に`textColor`と`size`を追加
- `vercel.json`: Vercelデプロイ用の設定ファイルを追加

---

## [0.2.3] - 2025-11-07

### 修正
- **画像切り替え時の白画面問題を解決**: 画像→画像の切り替え時にフェードを無効化
  - 動画⇔画像の切り替え時のみフェードイン/アウトを適用
  - 画像が連続表示される際にスムーズに切り替わるように改善
- **動画再生時間の改善**: 動画の実際の長さを使用して再生時間を決定
  - 従来のランダム時間（10-20秒）ではなく、動画全体を再生するように変更
  - 動画のメタデータから実際の長さを取得して使用
- **設定画面の可読性向上**: テキスト色を明示的に`text-gray-900`に設定
  - globals.cssのbody要素の白いテキスト色を継承しないように修正

### 変更
- **UIの改善**:
  - メディアライブラリと設定ボタンをハンバーガーメニューに統合
  - 右上のハンバーガーアイコンをクリックでメニュー表示
  - メニュー外クリックで自動的に閉じる機能を追加
  - 普段は目立たないシンプルなUIに
- **カレンダー位置の簡素化**: 4パターン（左上・右上・左下・右下）から選択可能に
  - 中央配置オプション（top-center, bottom-center）を削除
- **画像表示時間**: デフォルトを5秒から7秒に変更
- **1か月表示カレンダーの改善**:
  - グラスモーフィズム背景を追加（bg-white/20 backdrop-blur-md）
  - 表示サイズを大幅に拡大（曜日: text-lg、日付: text-xl、月年: text-5xl）
  - セルサイズを拡大（w-14 h-14、gap-3）
  - 今日の日付を強調表示（scale-110、bg-white/30）
  - よりはっきりとしたテキストシャドウを適用

### 技術的な改善
- `MediaPlayer.tsx`:
  - 前回のラウンドを追跡し、画像→画像切り替え時はフェードをスキップ
  - VideoPlayerで動画のloadedmetadataイベントを監視し、実際の長さを取得
  - ImageItemにkeyプロパティを追加してアニメーションを確実にリセット
- `Player.tsx`:
  - ハンバーガーメニューUIを実装、メニュー外クリック検知を追加
  - 動画再生時にcurrentVideoDurationを使用
  - useEffectの依存配列にcurrentImages, currentVideoIdを追加し、画像切り替え時にタイマーを再設定
- `Calendar.tsx`:
  - MonthCalendarにグラスモーフィズム背景を追加
  - サイズとスペーシングを全体的に拡大
- `Settings.tsx`:
  - カレンダー位置選択UIを追加
  - ルート要素にtext-gray-900を追加
- `types/index.ts`:
  - CalendarPosition型を4パターンに変更
  - PlaybackStateにcurrentVideoDurationを追加
  - デフォルトimageDurationを7秒に変更

---

## [0.2.2] - 2025-11-07

### 追加
- **フォント選択機能**: カレンダーのフォントを7種類のGoogleフォントから選択可能に
  - 選択可能なフォント: Roboto, Montserrat, Questrial, Anton, Lato, Cormorant Garamond, Libre Baskerville
  - 設定画面で各フォントのサンプル（11/7 (Thu)）をリアルタイムプレビュー
  - デフォルトはRoboto

### 技術的な改善
- `layout.tsx`: 7つのGoogleフォントをnext/font/googleで一括読み込み
- `types/index.ts`: CalendarFont型を追加、CalendarSettingsにfontプロパティを追加
- `globals.css`: 各フォント用のユーティリティクラスを追加
- `Calendar.tsx`: 選択されたフォントを動的に適用
- `Settings.tsx`: フォント選択UIをラジオボタン形式で実装、各フォントのサンプル表示機能を追加

---

## [0.2.1] - 2025-11-07

### 修正
- **再生ロジックの改善**: 動画→画像×3→動画のループ再生を実現
  - 画像表示時にもタイマーが正しく設定されるように変更
  - 画像表示時間経過後に次の画像または動画に進むロジックを実装
  - 画像スロット数を3に設定し、動画→画像ランダム→画像ランダム→画像ランダム→動画のループに
- **画像アニメーションの最適化**: 上下の空白を最小化し、滑らかな動きを実現
  - アニメーション移動範囲を一方向に変更（0% → 4%）
  - `animation-fill-mode: forwards`により最後の位置で停止
  - 画像を110%（1.1倍）に拡大して表示し、移動時も空白が見えないように

### 変更
- **カレンダーデザイン**:
  - フォントをGoogleフォントのHindに変更（next/font/googleで最適化）
  - 文字色を白に変更
  - グラスモーフィズム背景を削除しシンプルなデザインに
  - 日付表示サイズを大幅に拡大（text-6xl → text-9xl）
  - デフォルト位置を画面左下に変更（top-right → bottom-left）
  - 曜日と記念日表示のサイズも比例して拡大
  - 控えめなドロップシャドウを追加（0 1px 3px rgba(0,0,0,0.15)）

### 技術的な改善
- `Player.tsx`: useEffectで画像表示時のタイマー処理を追加
- `Calendar.tsx`:
  - グラスモーフィズムを削除し、font-hindクラスを適用
  - 日付表示をtext-9xl、曜日をtext-6xlに拡大
  - ドロップシャドウを控えめに調整
- `layout.tsx`: GoogleフォントのHindをnext/font/googleでインポート
- `globals.css`: Hindフォントのユーティリティクラスを追加
- `types/index.ts`: デフォルトカレンダー位置をbottom-leftに変更
- `MediaPlayer.tsx`: アニメーションをforwardsモードに変更（0% → 4%で停止）

---

## [0.2.0] - 2025-11-07

### 追加
- **ランダム画像枚数**: 画像表示が1枚または2枚にランダムで切り替わるように改善
- **フルスクリーン表示**: 動画と画像を画面いっぱいに表示（`object-cover`を使用）
- **グラスモーフィズムUI**: カレンダーの背景にグラスモーフィズム効果を適用
  - 半透明の白背景（`bg-white/30`）
  - ぼかし効果（`backdrop-blur-md`）
  - 角丸とシャドウで洗練されたデザイン

### 変更
- **画像表示ロジック**:
  - 1枚の場合: 画面中央に全画面表示
  - 2枚の場合: 左右に分割して全画面表示
  - `object-cover`により画像が画面全体をカバー
- **動画表示**: `object-contain`から`object-cover`に変更し、画面いっぱいに表示
- **動画切り替えロジック**: 動画が1つしかない場合は週が変わっても同じ動画を継続表示

### 技術的な改善
- `RoundConductor`: 画像枚数をランダムに1-2枚選択するロジックを実装
- `WeeklyVideoScheduler`: 動画が1つの場合の特別処理を追加
- `MediaPlayer`: 画像枚数に応じたレイアウト切り替えを実装
- `Calendar`: グラスモーフィズムスタイルを適用

---

## [0.1.0] - 2025-11-07

### 初期リリース

#### 主要機能
- **週替わり動画再生**: 毎週異なる動画を自動的に再生
- **画像スライドショー**: 2枚の画像を左右に配置し、緩やかに上から下にアニメーション
- **フェード効果**: 動画・画像が滑らかにフェードイン・フェードアウト
- **カレンダー表示**: 日付や月のカレンダーを常に最前面に表示（表示/非表示切替可能）
- **多様性のある画像選択**: 履歴管理とタグ分散による偏りのない画像表示

#### 設定機能
- **基本設定**
  - 言語切替（日本語/英語）
  - 背景色の変更（デフォルト: 白）
- **カレンダー設定**
  - カレンダー表示のON/OFF
  - 表示モード（1日/1か月）
  - 週の開始曜日（日曜/月曜）
- **メディア設定**
  - 画像表示時間（3〜15秒）
  - フェードイン時間（0.5〜3秒）
  - フェードアウト時間（0.5〜3秒）
  - アニメーション速度（0.5〜2倍速）
  - 音量（0〜100%）

#### 技術スタック
- Next.js 14 (App Router)
- TypeScript
- Tailwind CSS
- Zustand (状態管理)
- IndexedDB (永続化)
- date-fns (日付処理)

#### コアクラス
- `CalendarService`: 日付計算とカレンダー表示
- `WeeklyVideoScheduler`: 週次動画スケジュール管理
- `DiversityPicker`: 画像の多様性を保つ選択ロジック
- `ShuffleQueue`: 重み付きシャッフルキュー
- `RoundConductor`: 再生シーケンス管理
- `StorageRepo`: IndexedDB永続化

#### UIコンポーネント
- `Player`: メインプレーヤー画面
- `MediaPlayer`: 動画・画像表示
- `Calendar`: カレンダー表示（1日/1か月）
- `Settings`: 設定画面
- `MediaLibrary`: メディアライブラリ管理

#### 特徴
- PWA対応（オフライン動作可能）
- 完全ローカル（クラウド不要）
- デザインシステム対応
- レスポンシブデザイン
